<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='Kevlar-ModelCache'>/**
</span> * @private
 * @class Kevlar.ModelCache
 * @singleton
 * 
 * Singleton class which caches models by their type (subclass type), and id. This is used
 * to retrieve models, and not duplicate them when instantiating the same model type with the
 * same instance id. 
 * 
 * This is a class used internally by Kevlar, and should not be used directly.
 */
/*global Kevlar */
Kevlar.ModelCache = {
	
<span id='Kevlar-ModelCache-property-modelTypeIdCounter'>	/**
</span>	 * Private variable which is used to return new unique ID's for each model type ({@link Kevlar.Model} subclass).
	 * 
	 * @private
	 * @property {Number} modelTypeIdCounter
	 */
	modelTypeIdCounter : 0,
	
	
<span id='Kevlar-ModelCache-property-models'>	/**
</span>	 * The hashmap of model references stored in the cache. This hashmap is a two-level hashmap, first keyed by the
	 * {@link Kevlar.Model Model's} assigned `__Kevlar_modelTypeId`, and then its instance id.
	 * 
	 * @private
	 * @property {Object} models
	 */
	models : {},
	
	
<span id='Kevlar-ModelCache-method-get'>	/**
</span>	 * Returns a Model that is in the cache with the same model type (model subclass) and instance id, if one exists
	 * that matches the type of the provided `model`, and the provided instance `id`. If a Model does not already exist, 
	 * the provided `model` is simply returned.
	 * 
	 * @method get
	 * @param {Kevlar.Model} model
	 * @param {String} [id]
	 */
	get : function( model, id ) {
		var modelClass = model.constructor,
		    modelTypeId = modelClass.__Kevlar_modelTypeId,  // the current modelTypeId, if any
		    cachedModel;
				
		// Assign this Model subclass a unique modelTypeId if it doesn't have one yet
		if( !modelTypeId ) {
			modelTypeId = ++this.modelTypeIdCounter;
			
			// Assign the model's constructor (i.e. the Kevlar.Model subclass) a new, unique modelTypeId
			modelClass.__Kevlar_modelTypeId = modelTypeId;
			
			// Add a hashmap for the new model type in the cache as well
			this.models[ modelTypeId ] = {};
		}
				
		// If the model has an id provided with it, pull the cached model with that id (if it exists), or otherwise cache it
		if( typeof id !== 'undefined' ) {
			cachedModel = this.models[ modelTypeId ][ id ];
			if( !cachedModel ) {
				this.models[ modelTypeId ][ id ] = model;
			}
		}
		
		return cachedModel || model;
	}

};</pre>
</body>
</html>
