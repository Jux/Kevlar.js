/*!
 * Kevlar JS Library
 * Copyright(c) 2011 Gregory Jacobs.
 * MIT Licensed. http://www.opensource.org/licenses/mit-license.php
 */
/*
 * Copyright(c) 2006-2009, Ext JS, LLC.
 * 
 * Parts of this library are from Ext-Core.
 * 
 * MIT Licensed - http://extjs.com/license/mit.txt
 */
var Kevlar=function(){var a=window.navigator.userAgent.toLowerCase();this.isIE=/msie/.test(a)&&!(/opera/.test(a))};Kevlar.prototype={constructor:Kevlar,emptyFn:function(){},abstractFn:function(){throw new Error("method must be implemented in subclass")},newId:(function(){var a=0;return function(){return ++a}})(),apply:function(d,e,b){if(b){Kevlar.apply(d,b)}if(d&&e&&typeof e=="object"){for(var a in e){d[a]=e[a]}}return d},applyIf:function(b,d){if(b){for(var a in d){if(!Kevlar.isDefined(b[a])){b[a]=d[a]}}}return b},extend:(function(){var b=0,a=Object.prototype.constructor;var c=function(e){for(var d in e){this[d]=e[d]}};return function(n,k,l){if(!Kevlar.isArray(k)){l=k;k=[]}var h=l.constructor!=a?l.constructor:function(){n.apply(this,arguments)},o=function(){},g,f=n.prototype;o.prototype=f;g=h.prototype=new o();g.constructor=h;h.superclass=h.__super__=f;if(f.constructor==a){f.constructor=n}h.override=function(i){Kevlar.override(h,i)};g.superclass=g.supr=(function(){return f});g.override=c;Kevlar.override(h,l);h.extend=function(i,p){return Kevlar.extend(h,i,p)};h.constructor=g.constructor;for(var j=k.length-1;j>=0;j--){var m=k[j].prototype;for(var e in m){if(typeof g[e]==="undefined"){g[e]=m[e]}}}h.mixins=k;var d={};h.hasMixin=g.hasMixin=function(w,v){var u=w._classId;if(!u){u=w._classId=++b}if(typeof d[u]!=="undefined"){return d[u]}else{var t=v||h,q=t.mixins;if(!q){d[u]=false;return false}for(var r=0,p=q.length;r<p;r++){if(q[r]===w){d[u]=true;return true}}if(t.superclass&&t.superclass.constructor&&t.superclass.constructor!==Object){var s=arguments.callee(w,t.superclass.constructor);d[u]=s;return s}else{d[u]=false;return false}}};return h}})(),isInstanceOf:function(b,a){if(typeof a!=="function"){throw new Error("jsClass argument of isInstanceOf method expected a Function (constructor function) for a JavaScript class")}if(!Kevlar.isObject(b)){return false}else{if(b instanceof a){return true}else{if(b.hasMixin&&b.hasMixin(a)){return true}else{return false}}}},override:function(a,c){if(c){var b=a.prototype;Kevlar.apply(b,c);if(Kevlar.isIE&&c.hasOwnProperty("toString")){b.toString=c.toString}}},namespace:function(){var b,a;Kevlar.each(arguments,function(c){a=c.split(".");b=window[a[0]]=window[a[0]]||{};Kevlar.each(a.slice(1),function(d){b=b[d]=b[d]||{}})});return b},toArray:function(d,g,e,f){if(Kevlar.isIE){f=[];for(var c=0,b=d.length;c<b;c++){f.push(d[c])}return f.slice(g||0,e||f.length)}else{return Array.prototype.slice.call(d,g||0,e||d.length)}},each:function(e,d,c){if(Kevlar.isEmpty(e,true)){return}if(typeof e.length==="undefined"||Kevlar.isPrimitive(e)){e=[e]}for(var b=0,a=e.length;b<a;b++){if(d.call(c||e[b],e[b],b,e)===false){return b}}},isArray:function(a){return !!a&&Object.prototype.toString.apply(a)==="[object Array]"},isObject:function(a){return !!a&&Object.prototype.toString.call(a)==="[object Object]"},isFunction:function(a){return !!a&&a.constructor===Function},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},isString:function(a){return typeof a==="string"},isNumber:function(a){return typeof a==="number"&&isFinite(a)},isBoolean:function(a){return typeof a==="boolean"},isRegExp:function(a){return !!a&&a.constructor===RegExp},isElement:function(a){return a?a.nodeType===1:false},isJQuery:function(a){return a instanceof jQuery},isDefined:function(a){return typeof a!=="undefined"},isUndefined:function(a){return typeof a==="undefined"},isPrimitive:function(a){return Kevlar.isString(a)||Kevlar.isNumber(a)||Kevlar.isBoolean(a)},isEmpty:function(b,a){return b===null||b===undefined||((Kevlar.isArray(b)&&!b.length))||(!a?b==="":false)}};Kevlar=new Kevlar();Kevlar.namespace("Kevlar.persistence","Kevlar.util");(function(){var a=Kevlar.util,k=Kevlar.toArray,j=Kevlar.each,b=Kevlar.isObject,h=true,i=false;a.Observable=function(){var l=this,m=l.events;l.events=m||{};if(l.listeners){l.on(l.listeners);delete l.listeners}};a.Observable.prototype={filterOptRe:/^(?:scope|delay|buffer|single)$/,fireEvent:function(){var s=k(arguments),p=s[0].toLowerCase(),u=this,r=h,n=u.events[p],l,o;if(u.eventsSuspended===h){l=u.eventQueue;if(l){l.push(s)}}else{if(b(n)&&n.bubble){if(n.fire.apply(n,s.slice(1))===false){return i}var m=n.bubbleFn,t=n.bubbleFnScope;if(m&&m.call(t,this)===false){return false}o=u.getBubbleTarget&&u.getBubbleTarget();if(o&&o.enableBubble){if(!o.events[p]||!Kevlar.isObject(o.events[p])||!o.events[p].bubble||(!o.events[p].bubbleFn&&m)){o.enableBubble({eventName:p,bubbleFn:m,scope:t})}return o.fireEvent.apply(o,s)}}else{if(b(n)){s.shift();r=n.fire.apply(n,s)}}}return r},addListener:function(n,r,t,m){var q=this,p,u,s,l;if(b(n)){m=n;for(p in m){u=m[p];if(!q.filterOptRe.test(p)){q.addListener(p,u.fn||u,u.scope||m.scope,u.fn?u:m)}}}else{n=n.toLowerCase();l=q.events[n]||h;if(Kevlar.isBoolean(l)){q.events[n]=l=new a.Event(q,n)}l.addListener(r,t,b(m)?m:{})}return this},removeListener:function(l,n,m){var o=this.events[l.toLowerCase()];if(b(o)){o.removeListener(n,m)}return this},purgeListeners:function(){var n=this.events,l,m;for(m in n){l=n[m];if(b(l)){l.clearListeners()}}},addEvents:function(p){var n=this;n.events=n.events||{};if(Kevlar.isString(p)){var l=arguments,m=l.length;while(m--){n.events[l[m]]=n.events[l[m]]||h}}else{Kevlar.applyIf(n.events,p)}},hasListener:function(l){var m=this.events[l];return b(m)&&m.listeners.length>0},suspendEvents:function(l){this.eventsSuspended=h;if(l&&!this.eventQueue){this.eventQueue=[]}},resumeEvents:function(){var l=this,m=l.eventQueue||[];l.eventsSuspended=i;delete l.eventQueue;j(m,function(n){l.fireEvent.apply(l,n)})},relayEvents:function(s,p){var r=this;function q(o){return function(){return r.fireEvent.apply(r,[o].concat(Array.prototype.slice.call(arguments,0)))}}for(var n=0,l=p.length;n<l;n++){var m=p[n];r.events[m]=r.events[m]||true;s.on(m,q(m),r)}},enableBubble:function(l){var m=this;if(!Kevlar.isEmpty(l)){l=Kevlar.isArray(l)?l:Kevlar.toArray(arguments);Kevlar.each(l,function(r){var n,q,o;if(typeof r==="object"){n=r.eventName;q=r.bubbleFn;o=r.scope}else{n=r}n=n.toLowerCase();var p=m.events[n]||true;if(Kevlar.isBoolean(p)){p=new a.Event(m,n);m.events[n]=p}p.bubble=true;if(typeof q==="function"){p.bubbleFn=q;p.bubbleFnScope=o||m}})}},getBubbleTarget:function(){return null}};var f=a.Observable.prototype;f.on=f.addListener;f.un=f.removeListener;f.bind=f.addListener;f.unbind=f.removeListener;f.trigger=f.fireEvent;a.Observable.releaseCapture=function(l){l.fireEvent=f.fireEvent};function g(m,n,l){return function(){if(n.target==arguments[0]){m.apply(l,k(arguments))}}}function d(p,q,m,n){m.task=new a.DelayedTask();return function(){m.task.delay(q.buffer,p,n,k(arguments))}}function e(n,o,m,l){return function(){o.removeListener(m,l);return n.apply(l,arguments)}}function c(p,q,m,n){return function(){var l=new a.DelayedTask();if(!m.tasks){m.tasks=[]}m.tasks.push(l);l.delay(q.delay||10,p,n,k(arguments))}}a.Event=function(m,l){this.name=l;this.obj=m;this.listeners=[]};a.Event.prototype={addListener:function(p,o,n){var q=this,m;o=o||q.obj;if(!q.isListening(p,o)){m=q.createListener(p,o,n);if(q.firing){q.listeners=q.listeners.slice(0)}q.listeners.push(m)}},createListener:function(q,p,r){r=r||{};p=p||this.obj;var m={fn:q,scope:p,options:r},n=q;if(r.target){n=g(n,r,p)}if(r.delay){n=c(n,r,m,p)}if(r.single){n=e(n,this,q,p)}if(r.buffer){n=d(n,r,m,p)}m.fireFn=n;return m},findListener:function(q,p){var r=this.listeners,n=r.length,m,o;while(n--){m=r[n];if(m){o=m.scope;if(m.fn==q&&(o==p||o==this.obj)){return n}}}return -1},isListening:function(m,l){return this.findListener(m,l)!=-1},removeListener:function(r,q){var p,m,n,s=this,o=i;if((p=s.findListener(r,q))!=-1){if(s.firing){s.listeners=s.listeners.slice(0)}m=s.listeners[p];if(m.task){m.task.cancel();delete m.task}n=m.tasks&&m.tasks.length;if(n){while(n--){m.tasks[n].cancel()}delete m.tasks}s.listeners.splice(p,1);o=h}return o},clearListeners:function(){var o=this,m=o.listeners,n=m.length;while(n--){o.removeListener(m[n].fn,m[n].scope)}},fire:function(){var r=this,o=k(arguments),q=r.listeners,m=q.length,p=0,n,s=false;if(m>0){r.firing=h;for(;p<m;p++){n=q[p];if(n&&n.fireFn.apply(n.scope||r.obj||window,o)===i){s=true}}}r.firing=i;return(s)?false:true}}})();Kevlar.persistence.Proxy=Kevlar.extend(Kevlar.util.Observable,{constructor:function(a){Kevlar.apply(this,a)},create:Kevlar.abstractFn,read:Kevlar.abstractFn,update:Kevlar.abstractFn,destroy:Kevlar.abstractFn});Kevlar.apply(Kevlar.persistence.Proxy,{proxies:{},register:function(a,b){var c=Kevlar.persistence.Proxy;a=a.toLowerCase();if(typeof b!=="function"){throw new Error("A Proxy subclass constructor function must be provided to registerProxy()")}if(!c.proxies[a]){c.proxies[a]=b}else{throw new Error("Error: Proxy type '"+a+"' already registered.")}},create:function(a){var c=Kevlar.persistence.Proxy;var b=a.type?a.type.toLowerCase():undefined;if(a instanceof Kevlar.persistence.Proxy){return a}else{if(c.proxies[b]){return new c.proxies[b](a)}else{if(!("type" in a)){throw new Error("Kevlar.persistence.proxy.create(): No `type` property provided on proxy config object")}else{throw new Error("Kevlar.persistence.Proxy.create(): Unknown Proxy type: '"+b+"'")}}}}});Kevlar.Field=Kevlar.extend(Object,{name:"",persist:true,constructor:function(b){if(typeof b!=="object"){b={name:b}}Kevlar.apply(this,b);var a=this.name;if(a===undefined||a===null||a===""){throw new Error("no 'name' property provided to Kevlar.Field constructor")}else{if(typeof this.name==="number"){this.name=a.toString()}}if(this["default"]){this.defaultValue=this["default"]}if(typeof this.defaultValue==="function"){this.defaultValue=this.defaultValue()}if(typeof this.defaultValue==="object"){(function c(d){for(var e in d){if(d.hasOwnProperty(e)){if(typeof d[e]==="function"){d[e]=d[e]()}else{if(typeof d[e]==="object"){c(d[e])}}}}})(this.defaultValue)}},getName:function(){return this.name},isPersisted:function(){return this.persist}});Kevlar.Model=Kevlar.extend(Kevlar.util.Observable,{proxy:null,addFields:[],idField:"id",dirty:false,constructor:function(c){Kevlar.Model.superclass.constructor.call(this);if(this.proxy&&typeof this.proxy==="object"&&!(this.proxy instanceof Kevlar.persistence.Proxy)){this.constructor.prototype.proxy=Kevlar.persistence.Proxy.create(this.proxy)}this.addEvents("change");this.initFields();this.cid="c"+(++Kevlar.Model.currentCid);c=c||{};var a=this.fields;for(var b in a){if(c[b]===undefined){c[b]=a[b].defaultValue}}this.data={};this.modifiedData={};this.set(c);this.commit();this.initialize(c)},initialize:Kevlar.emptyFn,initFields:function(){this.fields={};var d=[],e=this.constructor,b=e.prototype;do{if(b.hasOwnProperty("addFields")&&Kevlar.isArray(b.addFields)){d=d.concat(b.addFields)}}while((e=(b=e.superclass)&&b.constructor));for(var a=d.length;a--;){var c=d[a];if(typeof c==="string"){c={name:c}}var f=this.createField(c);this.fields[f.getName()]=f}},createField:function(a){return new Kevlar.Field(a)},getFields:function(){return this.fields},getId:function(){return this.get(this.idField)},get:function(a){if(!(a in this.fields)){throw new Error("Kevlar.Model::get() error: provided field '"+a+"' was not found in the Model.")}return this.data[a]},set:function(j,f){var c=this.fields,b=[];if(typeof j==="object"){var h=j;for(j in h){if(h.hasOwnProperty(j)&&(j in c)){if(typeof c[j].convert==="function"){b.push(j)}else{this.set(j,h[j])}}}for(var a=0,d=b.length;a<d;a++){j=b[a];this.set(j,h[j])}}else{var e=c[j];if(!e){throw new Error("Kevlar.Model.set(): A field with the fieldName '"+j+"' was not found.")}if(typeof e.convert==="function"){f=e.convert.call(e.scope||window,f,this)}var g=this.data[j];if(!(j in this.data)||!Kevlar.util.Object.isEqual(g,f)){if(!(j in this.modifiedData)){this.modifiedData[j]=g}this.data[j]=f;this.dirty=true;if(j===this.idField){this.id=f}this.fireEvent("change:"+j,this,f);this.fireEvent("change",this,j,f)}}},getDefault:function(a){return this.fields[a].defaultValue},has:function(a){return !!this.fields[a]},isDirty:function(){return this.dirty},isModified:function(a){return this.modifiedData.hasOwnProperty(a)},getData:function(){return Kevlar.util.Object.clone(this.data)},getPersistedData:function(){return this.filterNonPersisted(this.getData())},getChanges:function(){var b=Kevlar.util.Object.clone(this.modifiedData),a={};for(var c in b){if(b.hasOwnProperty(c)){a[c]=this.get(c)}}return a},getPersistedChanges:function(){return this.filterNonPersisted(this.getChanges())},commit:function(){this.modifiedData={};this.dirty=false},rollback:function(){var a=this.modifiedData;for(var b in a){if(a.hasOwnProperty(b)){this.data[b]=a[b]}}this.modifiedData={};this.dirty=false},setProxy:function(a){this.constructor.prototype.proxy=a},getProxy:function(){return this.proxy},load:function(b){b=b||{};if(!this.proxy){throw new Error("Kevlar.Model::load() error: Cannot load. No proxy.")}var a={async:(typeof b.async==="undefined")?true:b.async,success:b.success||Kevlar.emptyFn,failure:b.failure||Kevlar.emptyFn,complete:b.complete||Kevlar.emptyFn,scope:b.scope||window};this.proxy.read(this,a)},save:function(d){d=d||{};if(!this.proxy){throw new Error("Kevlar.Model::save() error: Cannot save. No proxy.")}var f=Kevlar.util.Object.clone(this.data);var a=function(){this.commit();var g=this.getData();for(var h in f){if(f.hasOwnProperty(h)&&!Kevlar.util.Object.isEqual(f[h],g[h])){this.modifiedData[h]=f[h];this.dirty=true}}if(typeof d.success==="function"){d.success.call(d.scope||window)}};var c=function(){if(typeof d.error==="function"){d.error.call(d.scope||window)}};var e=function(){if(typeof d.complete==="function"){d.complete.call(d.scope||window)}};var b={async:(typeof d.async==="undefined")?true:d.async,success:a,error:c,complete:e,scope:this};this.proxy.update(this,b)},filterNonPersisted:function(b){var a=this.getFields();for(var c in a){if(a.hasOwnProperty(c)&&a[c].isPersisted()===false){delete b[c]}}return b}});Kevlar.Model.prototype.fetch=Kevlar.Model.prototype.load;Kevlar.Model.prototype.toJSON=Kevlar.Model.prototype.getData;Kevlar.Model.currentCid=0;Kevlar.persistence.RestProxy=Kevlar.extend(Kevlar.persistence.Proxy,{urlRoot:"",appendId:true,incremental:false,rootProperty:"",ajax:jQuery.ajax,setRootProperty:function(a){this.rootProperty=a},create:function(){throw new Error("create() not yet implemented")},read:function(c,b){b=b||{};var a=function(d){c.set(d);c.commit();if(typeof b.success==="function"){b.success.call(b.scope||window)}};this.ajax({async:(typeof b.async==="undefined")?true:b.async,url:this.buildUrl(c.getId()),type:"GET",dataType:"json",success:a,error:b.error||Kevlar.emptyFn,complete:b.complete||Kevlar.emptyFn,context:b.scope||window})},update:function(e,d){d=d||{};var c=e.getPersistedChanges();if(Kevlar.util.Object.isEmpty(c)){if(typeof d.success==="function"){d.success.call(d.scope||window)}if(typeof d.complete==="function"){d.complete.call(d.scope||window)}return}var b;if(this.incremental){b=c}else{b=e.getPersistedData()}if(this.rootProperty){var a={};a[this.rootProperty]=b;b=a}this.ajax({async:(typeof d.async==="undefined")?true:d.async,url:this.buildUrl(e.getId()),type:"PUT",data:JSON.stringify(b),contentType:"application/json",success:d.success||Kevlar.emptyFn,error:d.error||Kevlar.emptyFn,complete:d.complete||Kevlar.emptyFn,context:d.scope||window})},destroy:function(b,a){a=a||{};this.ajax({async:(typeof a.async==="undefined")?true:a.async,url:this.buildUrl(b.getId()),type:"DELETE",success:a.success||Kevlar.emptyFn,error:a.error||Kevlar.emptyFn,complete:a.complete||Kevlar.emptyFn,context:a.scope||window})},buildUrl:function(b){var a=this.urlRoot;if(this.appendId&&b){if(!a.match(/\/$/)){a+="/"}a+=b}return a}});Kevlar.persistence.Proxy.register("rest",Kevlar.persistence.RestProxy);Kevlar.util.DelayedTask=function(d,c,a){var e=this,f,b=function(){clearInterval(f);f=null;d.apply(c,a||[])};e.delay=function(h,j,i,g){e.cancel();d=j||d;c=i||c;a=g||a;f=setInterval(b,h)};e.cancel=function(){if(f){clearInterval(f);f=null}};e.isPending=function(){return !!f}};Kevlar.util.Object={clone:function(d,a){if(typeof a==="undefined"){a=true}var e;if(typeof d!=="object"||d===null){return d}e=new d.constructor();for(var b in d){if(d.hasOwnProperty(b)){e[b]=a?Kevlar.util.Object.clone(d[b],true):d[b]}}return e},isEqual:function(e,c,d){if(typeof d==="undefined"){d=true}if(typeof e!==typeof c){return false}if(typeof e!=="object"){if(e!==c){return false}}else{if(e==null||c==null){return e===c}if(Kevlar.isArray(e)!==Kevlar.isArray(c)){return false}var f=Kevlar.util.Object.length;if(f(e)!==f(c)){return false}for(var g in e){if(typeof(e[g])!==typeof(c[g])){return false}if((e[g]===null)!==(c[g]===null)){return false}switch(typeof(e[g])){case"undefined":if(typeof(c[g])!="undefined"){return false}break;case"object":if(e[g]!==null&&c[g]!==null&&(e[g].constructor.toString()!==c[g].constructor.toString()||(d?!Kevlar.util.Object.isEqual(e[g],c[g]):false))){return false}break;case"function":if(e[g].toString()!=c[g].toString()){return false}break;default:if(e[g]!==c[g]){return false}}}}return true},length:function(c){var a=0;for(var b in c){if(c.hasOwnProperty(b)){a++}}return a},isEmpty:function(b){for(var a in b){if(b.hasOwnProperty(a)){return false}}return true}};